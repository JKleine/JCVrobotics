<!DOCTYPE html>
<html>
<head>
    <title>J1 Robot Teleoperation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="date=no">
    <!-- CRITICAL FIX: CSS path now correctly references the local file -->
    <link rel="stylesheet" type="text/css" href="/assets/classic.css">
    
    <!-- Custom Styles for Functional Elements -->
    <style>
        #video-container {
            width: 100%;
            max-width: 100%; 
            aspect-ratio: 4/3; 
            overflow: hidden;
            background-color: black;
            border: 4px solid var(--c-orange); /* Assuming c-orange is defined in classic.css */
            margin-bottom: 20px; 
            border-right:#CCAAFF 8px solid; /* Accent right border in light blue */
            border-left:#CCAAFF 8px solid; 
            border-radius: 15px;
        }

        #camera-feed {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        #command-log {
            width: 100%;
            min-height: 150px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            background-color: #000;
            color: var(--c-text);
            border: 1px solid var(--c-text);
            padding: 5px;
            resize: none;
            margin-top: 20px; 
        }
        
        /* General LCARS-style control button grid */
        .lcars-button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 15px; 
        }

        /* LCARS button style override using classes defined in classic.css */
        .lcars-control-button {
            height: 45px; 
            border-radius: 9999px; /* Assuming this is handled by class-specific styles in classic.css */
            text-transform: uppercase;
            font-weight: bold;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            line-height: 1;
            padding: 0 15px;
            white-space: nowrap; 
            display: flex;
            align-items: center;
            justify-content: center;
            color: black; /* Force text black for all control buttons, matching the template image */
        }
        
        /* Custom style to reduce the size of the main heading */
        .main-heading-small {
            font-size: 1.2rem; /* Significantly smaller than default h1 */
            margin-bottom: 0.1rem !important;
            padding-bottom: 0 !important;
        }
        /* Style to ensure the original template panel 1 button looks right */
        .panel-1-button {
            /* This relies heavily on classic.css but sets the necessary base classes */
            text-transform: uppercase;
            font-weight: bold;
        }
        
        /* Specific colors used in the template image (approximate hex values) */
        .color-orange-deep { background-color: #FF9933; }
        .color-olive { background-color: #8C8C44; }
        .color-purple-light { background-color: #CCAAFF; }
        .color-magenta-bright { background-color: #CC33FF; }
        .color-red-brick { background-color: #993333; }
        .color-orange-light { background-color: #FF9966; }
        .color-blue-soft { background-color: #AACCFF; }
        .color-yellow-light { background-color: #DDAA55; }
        .color-pink-soft { background-color: #FFCCCC; }
        .color-orange-dark { background-color: #FF7733; }
        .color-pink-peach { background-color: #FF9988; }
        /* --- NEW STYLES FOR LCARS TEXT INPUT --- */
        .lcars-text-input {
            display: flex;
            height: 45px;
            border-radius: 9999px;
            overflow: hidden;
            font-family: sans-serif;
            font-size: 0.8rem;
            line-height: 1;
        }

        .lcars-text-input::before {
            content: '';
            display: block;
            width: 20px;
            background-color: #CCAAFF;
        }

        .lcars-text-input input[type="text"] {
            flex-grow: 1;
            background-color: #CCAAFF; /* Your 'color-purple-light' */
            border: none;
            outline: none;
            padding: 0 15px;
            color: #000;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .lcars-text-input .label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 15px;
            background-color: #CCAAFF;
            color: var(--c-orange, #000000);
            text-transform: uppercase;
            font-weight: bold;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- CRITICAL FIX: Audio and JS paths now correctly reference the local file/folder -->
    <audio id="audio1" src="/assets/beep1.mp3" preload="auto"></audio>
    <audio id="audio2" src="/assets/beep2.mp3" preload="auto"></audio>
    <audio id="audio3" src="/assets/beep3.mp3" preload="auto"></audio>
    <audio id="audio4" src="/assets/beep4.mp3" preload="auto"></audio>

    <section class="wrap-standard" id="column-3">
        <div class="wrap">
            <div class="left-frame-top">
                <!-- Top Left Panel FIX: Reverted to the original <button> structure using the required panel-1-button class (MANDATORY for template compatibility) -->
                <button onclick="playSoundAndRedirect('audio2', '#')" class="panel-1-button">J1 TeleOp</button>
                <div class="panel-2">02<span class="hop">-TELEOP MAP</span></div>
            </div>
            
            <div class="right-frame-top">
                <div class="banner">J1 &#149; ROBOTIC CONTROL INTERFACE</div>
                
                <div class="data-cascade-button-group">
                    <!-- Standard Data Cascade Display (Placeholder data) -->
                    <div class="data-cascade-wrapper" id="default">
                        <div class="data-column"><div class="dc-row-1">93</div><div class="dc-row-1">1853</div><div class="dc-row-3">7</div><div class="dc-row-5">4149</div></div>
                        <div class="data-column"><div class="dc-row-1">21509</div><div class="dc-row-2">80</div><div class="dc-row-4">46233</div><div class="dc-row-6">2014</div></div>
                        <div class="data-column"><div class="dc-row-1">585101</div><div class="dc-row-3">752</div><div class="dc-row-5">293612</div><div class="dc-row-7">206</div></div>
                        <div class="data-column"><div class="dc-row-2">24487255</div><div class="dc-row-4">4024161</div><div class="dc-row-6">35045462</div><div class="dc-row-7">41520257</div></div>
                        <div class="data-column"><div class="dc-row-1">33</div><div class="dc-row-2">04</div><div class="dc-row-4">15</div><div class="dc-row-6">65</div></div>
                        <div class="data-column"><div class="dc-row-1">0223</div><div class="dc-row-3">21366</div><div class="dc-row-5">1984</div><div class="dc-row-7">21854</div></div>
                        <div class="data-column"><div class="dc-row-1">633</div><div class="dc-row-3">6188</div><div class="dc-row-5">32881</div><div class="dc-row-7">2143</div></div>
                        <div class="data-column"><div class="dc-row-1">406822</div><div class="dc-row-3">38357</div><div class="dc-row-5">312</div><div class="dc-row-7">00708</div></div>
                        <div class="data-column"><div class="dc-row-1">12073</div><div class="dc-row-3">20254</div><div class="dc-row-5">26921</div><div class="dc-row-7">30102</div></div>
                        <div class="data-column"><div class="dc-row-2">25</div><div class="dc-row-4">62311</div><div class="dc-row-6">87</div><div class="dc-row-7">6895</div></div>
                        <div class="data-column"><div class="dc-row-1">72112</div><div class="dc-row-3">126523</div><div class="dc-row-5">210486</div><div class="dc-row-7">220655</div></div>
                        <div class="data-column"><div class="dc-row-1">272448</div><div class="dc-row-3">31802</div><div class="dc-row-5">581131</div><div class="dc-row-7">70104</div></div>
                        <div class="data-column"><div class="dc-row-2">102955</div><div class="dc-row-4">850233</div><div class="dc-row-6">465</div><div class="dc-row-7">210047</div></div>
                        <div class="data-column"><div class="dc-row-1">75222</div><div class="dc-row-3">858552</div><div class="dc-row-5">58414</div><div class="dc-row-7">808044</div></div>
                        <div class="data-column"><div class="dc-row-1">331025</div><div class="dc-row-3">395852</div><div class="dc-row-5">309150</div><div class="dc-row-7">210411</div></div>
                        <div class="data-column"><div class="dc-row-1">817660</div><div class="dc-row-3">462869</div><div class="dc-row-5">52074</div><div class="dc-row-7">80544</div></div>
                        <div class="data-column"><div class="dc-row-2">26419</div><div class="dc-row-4">79</div><div class="dc-row-6">8049</div><div class="dc-row-7">251664</div></div>
                        <div class="data-column"><div class="dc-row-1">900007</div><div class="dc-row-3">25819</div><div class="dc-row-5">409</div><div class="dc-row-7">527222</div></div>
                        <div class="data-column"><div class="dc-row-2">39001</div><div class="dc-row-4">57</div><div class="dc-row-6">4</div><div class="dc-row-7">6244009</div></div>
                        <div class="data-column"><div class="dc-row-1">2352</div><div class="dc-row-3">2721</div><div class="dc-row-5">540</div><div class="dc-row-7">23</div></div>
                        <div class="data-column"><div class="dc-row-1">66880</div><div class="dc-row-3">249009</div><div class="dc-row-5">9035768</div><div class="dc-row-7">825064</div></div>
                        <div class="data-column"><div class="dc-row-2">218035</div><div class="dc-row-4">82</div><div class="dc-row-6">799324</div><div class="dc-row-7">4404</div></div>
                        <div class="data-column"><div class="dc-row-1">8807</div><div class="dc-row-3">2104</div><div class="dc-row-5">446</div><div class="dc-row-7">526</div></div>
                        <div class="data-column"><div class="dc-row-1">593</div><div class="dc-row-3">23</div><div class="dc-row-5">2608</div><div class="dc-row-7">2103</div></div>
                    </div> 
                    
                    <!-- Top Right Navigation (Placeholder buttons) -->
                    <nav class="lcars-button-grid"> 
                        <button onclick="playSoundAndRedirect('audio2', '#')">A-BTN</button>
                        <button onclick="playSoundAndRedirect('audio2', '#')">B-BTN</button>
                        <button onclick="playSoundAndRedirect('audio2', '#')">X-BTN</button>
                        <button onclick="playSoundAndRedirect('audio2', '#')">Y-BTN</button>
                    </nav>
                </div>
                <div class="bar-panel first-bar-panel">
                    <div class="bar-1"></div>
                    <div class="bar-2"></div>
                    <div class="bar-3"></div>
                    <div class="bar-4"></div>
                    <div class="bar-5"></div>
                </div>
            </div>
        </div>
        
        <div class="wrap" id="gap">
            <div class="left-frame">
                <!-- SCROLL TO TOP OF PAGE BUTTON (Preserved from template) -->
                <button onclick="topFunction(); playSoundAndRedirect('audio4', '#')" id="topBtn"><span class="hop">screen</span> top</button>
                
                <!-- Left Sidebar Panels (Preserved from template) -->
                <div>
                    <div class="panel-3">03<span class="hop">-111968</span></div>
                    <div class="panel-4">04<span class="hop">-041969</span></div>
                    <div class="panel-5">05<span class="hop">-1701D</span></div>
                    <div class="panel-6">06<span class="hop">-071984</span></div>
                    <div class="panel-7">07<span class="hop">-081940</span></div>
                    <div class="panel-8">08<span class="hop">-47148</span></div>
                    <div class="panel-9">09<span class="hop">-081966</span></div>
                </div>
                
                <div>
                    <div class="panel-10">10<span class="hop">-31</span></div>
                </div>
            </div>
            
            <div class="right-frame">
                <div class="bar-panel">
                    <div class="bar-6"></div>
                    <div class="bar-7"></div>
                    <div class="bar-8"></div>
                    <div class="bar-9"></div>
                    <div class="bar-10"></div>
                </div>
                
                <main>
                    <!-- FIX 1 & 2: Change text, reduce font size, and remove H2 -->
                    <div class="lcars-text-bar the-end">
                        <span>J1 TeleOperation</span>
                    </div>
                    
                    <!-- Live Video Stream (Inserted here) -->
                    <div id="video-container">
                        <img id="camera-feed" src="http://192.168.254.31:8001/stream.mjpg" 
                             onerror="this.onerror=null; this.src='https://placehold.co/640x480/141428/CC3333?text=STREAM+OFFLINE'; this.style.opacity='0.5';" 
                             alt="Live Camera Feed">
                    </div>
                    
                    <div class="lcars-text-bar the-end">
                        <span>Control Interface</span>
                    </div>
                    <!-- Button Grid based on image_c77648.png -->
                    <div class="lcars-button-grid">
                        <!-- Row 1 -->
                        <button onclick="sendCommand('F')" class="lcars-control-button color-purple-light">Forward</button>
                        <button onclick="sendCommand('R')" class="lcars-control-button color-purple-light">Reverse</button>
                        <button onclick="sendCommand('LT')" class="lcars-control-button color-purple-light">Left</button>
                        
                        <!-- Row 2 -->
                        <button onclick="sendCommand('RT')" class="lcars-control-button color-purple-light">Right</button>
                        <button onclick="sendCommand('PAN_LEFT')" class="lcars-control-button color-orange-dark">Pan Left</button>
                        <button onclick="sendCommand('PAN_RIGHT')" class="lcars-control-button color-orange-dark">Pan Right</button>

                        <!-- Row 3 -->
                        <button onclick="sendCommand('TILT_UP')" class="lcars-control-button color-blue-soft">Tilt Up</button>
                        <button onclick="sendCommand('TILT_DOWN')" class="lcars-control-button color-blue-soft">Tilt Down</button>
                        <button onclick="sendCommand('LTOGGLE')" class="lcars-control-button color-magenta-bright">Light</button>

                        <!-- Row 4 -->
                        <button onclick="sendCommand('PLACEHOLDER')" class="lcars-control-button color-magenta-bright">Laser</button>
                        <button onclick="sendCommand('FRAMECAP')" class="lcars-control-button color-yellow-light">Frame Capture</button>
                        <button onclick="sendCommand('RECORD')" class="lcars-control-button color-yellow-light">Record</button>

                        <!-- Row 5 (Two columns wide) -->
                        <div class="lcars-text-input" style="grid-column: 1 / span 2;">
                            <input type="text" id="input_speech" placeholder="...">
                            <span class="label"></span>
                        </div>

                        <button onclick="handleVocalize()" class="lcars-control-button color-pink-peach">Vocalize</button>

                         <div class="lcars-text-input" style="grid-column: 1 / span 2;">
                            <input type="text" id="input_raw" placeholder="...">
                            <span class="label"></span>
                        </div>

                        <button onclick="handleSendRaw()" class="lcars-control-button color-pink-peach">Send</button>

                        <!-- Row 6 (Two columns wide) -->
                        <button onclick="sendCommand('S')" class="lcars-control-button color-pink-peach" style="grid-column: 1 / span 2;">Stop</button>

                    </div>
                    <!-- End Button Grid -->
                    <div class="lcars-text-bar the-end">
                        <span>Command Log</span>
                    </div>
                    <textarea id="command-log" rows="8"></textarea>
                    <div class="data-cascade-button-group">
                    <!-- Standard Data Cascade Display (Placeholder data) -->
                    <div class="data-cascade-wrapper" id="default">
                        <div class="data-column"><div class="dc-row-1">93</div><div class="dc-row-1">1853</div><div class="dc-row-3">7</div><div class="dc-row-5">4149</div></div>
                        <div class="data-column"><div class="dc-row-1">21509</div><div class="dc-row-2">80</div><div class="dc-row-4">46233</div><div class="dc-row-6">2014</div></div>
                        <div class="data-column"><div class="dc-row-1">585101</div><div class="dc-row-3">752</div><div class="dc-row-5">293612</div><div class="dc-row-7">206</div></div>
                        <div class="data-column"><div class="dc-row-2">24487255</div><div class="dc-row-4">4024161</div><div class="dc-row-6">35045462</div><div class="dc-row-7">41520257</div></div>
                        <div class="data-column"><div class="dc-row-1">33</div><div class="dc-row-2">04</div><div class="dc-row-4">15</div><div class="dc-row-6">65</div></div>
                        <div class="data-column"><div class="dc-row-1">0223</div><div class="dc-row-3">21366</div><div class="dc-row-5">1984</div><div class="dc-row-7">21854</div></div>
                        <div class="data-column"><div class="dc-row-1">633</div><div class="dc-row-3">6188</div><div class="dc-row-5">32881</div><div class="dc-row-7">2143</div></div>
                        <div class="data-column"><div class="dc-row-1">406822</div><div class="dc-row-3">38357</div><div class="dc-row-5">312</div><div class="dc-row-7">00708</div></div>
                        <div class="data-column"><div class="dc-row-1">12073</div><div class="dc-row-3">20254</div><div class="dc-row-5">26921</div><div class="dc-row-7">30102</div></div>
                        <div class="data-column"><div class="dc-row-2">25</div><div class="dc-row-4">62311</div><div class="dc-row-6">87</div><div class="dc-row-7">6895</div></div>
                        <div class="data-column"><div class="dc-row-1">72112</div><div class="dc-row-3">126523</div><div class="dc-row-5">210486</div><div class="dc-row-7">220655</div></div>
                        <div class="data-column"><div class="dc-row-1">272448</div><div class="dc-row-3">31802</div><div class="dc-row-5">581131</div><div class="dc-row-7">70104</div></div>
                        <div class="data-column"><div class="dc-row-2">102955</div><div class="dc-row-4">850233</div><div class="dc-row-6">465</div><div class="dc-row-7">210047</div></div>
                        <div class="data-column"><div class="dc-row-1">75222</div><div class="dc-row-3">858552</div><div class="dc-row-5">58414</div><div class="dc-row-7">808044</div></div>
                        <div class="data-column"><div class="dc-row-1">331025</div><div class="dc-row-3">395852</div><div class="dc-row-5">309150</div><div class="dc-row-7">210411</div></div>
                        <div class="data-column"><div class="dc-row-1">817660</div><div class="dc-row-3">462869</div><div class="dc-row-5">52074</div><div class="dc-row-7">80544</div></div>
                        <div class="data-column"><div class="dc-row-2">26419</div><div class="dc-row-4">79</div><div class="dc-row-6">8049</div><div class="dc-row-7">251664</div></div>
                        <div class="data-column"><div class="dc-row-1">900007</div><div class="dc-row-3">25819</div><div class="dc-row-5">409</div><div class="dc-row-7">527222</div></div>
                        <div class="data-column"><div class="dc-row-2">39001</div><div class="dc-row-4">57</div><div class="dc-row-6">4</div><div class="dc-row-7">6244009</div></div>
                        <div class="data-column"><div class="dc-row-1">2352</div><div class="dc-row-3">2721</div><div class="dc-row-5">540</div><div class="dc-row-7">23</div></div>
                        <div class="data-column"><div class="dc-row-1">66880</div><div class="dc-row-3">249009</div><div class="dc-row-5">9035768</div><div class="dc-row-7">825064</div></div>
                        <div class="data-column"><div class="dc-row-2">218035</div><div class="dc-row-4">82</div><div class="dc-row-6">799324</div><div class="dc-row-7">4404</div></div>
                        <div class="data-column"><div class="dc-row-1">8807</div><div class="dc-row-3">2104</div><div class="dc-row-5">446</div><div class="dc-row-7">526</div></div>
                        <div class="data-column"><div class="dc-row-1">593</div><div class="dc-row-3">23</div><div class="dc-row-5">2608</div><div class="dc-row-7">2103</div></div>
                    </div>
                    <!-- Original Template Content (Removed, except for attribution tags) -->
                    <!-- <footer> is outside <main> in the template -->

                </main>
                
                <footer>
                    Content &copy; 2025 J1 Robot Systems. <br>
                    LCARS Inspired Website Template by <a href="https://www.thelcars.com">www.Thelcars.com</a>. 
                </footer> 
            </div>
        </div>
    </section> 
    
    <script type="text/javascript" src="/assets/lcars.js"></script>
    
    <script>
    // --- Configuration (Must match robot system) ---
    // We use 'var' here to prevent 'const' syntax errors
    // if this script is accidentally merged with another.
    var ROBOT_HOST = window.location.hostname; 
    var WS_COMMAND_PORT = 65005;
    var VIDEO_BRIDGE_HTTP_PORT = 8001; 

    let socketClient = null;
    let commandLogEl = null;

    // --- Utility Functions ---

    function logCommand(message, isError = false) {
        if (!commandLogEl) {
            commandLogEl = document.getElementById('command-log');
        }
        if (commandLogEl) {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = isError ? '[ERROR]' : '[CMD]';
            commandLogEl.value += `${timestamp} ${prefix} ${message}\n`;
            commandLogEl.scrollTop = commandLogEl.scrollHeight;
        }
        if (isError) {
            console.error(message);
        } else {
            console.log(message);
        }
    }

    function sendCommand(cmd) {
        if (cmd.trim() === '') return;
        
        if (socketClient && socketClient.readyState === WebSocket.OPEN) {
            socketClient.send(cmd);
            logCommand(`Sent: ${cmd}`);
        } else {
            logCommand(`Socket not connected. Command '${cmd}' not sent.`, true);
        }
    }

    function connectSocket() {
        const wsUri = `ws://${ROBOT_HOST}:${WS_COMMAND_PORT}`;
        logCommand(`Connecting to WebSocket at ${wsUri}...`);
        
        try {
            socketClient = new WebSocket(wsUri);

            socketClient.onopen = function (event) {
                logCommand('Connection established. Ready for commands.');
            };

            socketClient.onmessage = function (event) {
                logCommand(`Server: ${event.data}`);
            };

            socketClient.onclose = function (event) {
                logCommand('Connection closed. Attempting to reconnect...', true);
                socketClient = null;
                setTimeout(connectSocket, 3000);
            };

            socketClient.onerror = function (event) {
                logCommand('WebSocket error. See browser console.', true);
                console.error('WebSocket Error:', event);
            };

        } catch (e) {
            logCommand(`Failed to create WebSocket: ${e}`, true);
        }
    }

    // --- Function to handle 'Enter' key in text inputs ---
    function handleVocalize() {
        const inputEl = document.getElementById('input_speech');
        const commandText = inputEl.value;
        if (commandText.trim() !== '') {
            // Prepend the "SPEAK" command, which robot_operator.py understands
            sendCommand(`SPEAK ${commandText}`);
            inputEl.value = ''; // Clear the input
        }
    }

    function handleSendRaw() {
        const inputEl = document.getElementById('input_raw');
        const commandText = inputEl.value;
        if (commandText.trim() !== '') {
            // Send the raw text directly
            sendCommand(commandText);
            inputEl.value = ''; // Clear the input
        }
    }

    // This new setup function hooks up the "Enter" key to our new functions
    function setupInputKeyHandlers() {
        const speechInput = document.getElementById('input_speech');
        const rawInput = document.getElementById('input_raw');

        if (speechInput) {
            speechInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    handleVocalize(); // Call the same function as the button
                }
            });
        }
        
        if (rawInput) {
            rawInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    handleSendRaw(); // Call the same function as the button
                }
            });
        }
    }

    // --- Modern, non-conflicting way to start the script ---
    document.addEventListener('DOMContentLoaded', function() {
        commandLogEl = document.getElementById('command-log');
        
        const videoURL = `http://${ROBOT_HOST}:${VIDEO_BRIDGE_HTTP_PORT}/stream.mjpg`;
        logCommand(`Attempting to load MJPEG stream from: ${videoURL}`);
        
        connectSocket();
        setupInputKeyHandlers();
    });
    </script>
    
    <div class="headtrim"> </div>
    <div class="baseboard"> </div>
</body>
</html>
